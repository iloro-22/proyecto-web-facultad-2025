{% extends 'core/base.html' %}

{% block title %}Mi Perfil - FarmaDelivery{% endblock %}

{% block content %}
<section class="hero">
    <h1>Mi Perfil</h1>
    <p>Gestiona tu información personal y preferencias</p>
</section>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-user"></i> Información Personal</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.telefono.id_for_label }}" class="form-label">Teléfono</label>
                            {{ form.telefono }}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.fecha_nacimiento.id_for_label }}" class="form-label">Fecha de Nacimiento</label>
                            {{ form.fecha_nacimiento }}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.obra_social.id_for_label }}" class="form-label">Obra Social</label>
                        {{ form.obra_social }}
                        <div class="form-text">Selecciona tu obra social para obtener descuentos automáticos</div>
                    </div>
                    <div class="mb-3" id="campo-numero-afiliado" style="display: none;">
                        <label for="{{ form.numero_afiliado.id_for_label }}" class="form-label">Número de Afiliado</label>
                        {{ form.numero_afiliado }}
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar Cambios
                    </button>
                </form>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h4 class="mb-0"><i class="fas fa-map-marker-alt"></i> Dirección Principal</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <strong>Calle:</strong><br>
                        <span class="text-muted">{{ cliente.direccion.calle }} {{ cliente.direccion.numero }}</span>
                    </div>
                    <div class="col-md-6">
                        <strong>Ciudad:</strong><br>
                        <span class="text-muted">{{ cliente.direccion.ciudad }}, {{ cliente.direccion.provincia }}</span>
                    </div>
                </div>
                <div class="mt-2">
                    <strong>Código Postal:</strong><br>
                    <span class="text-muted">{{ cliente.direccion.codigo_postal }}</span>
                </div>
                <div class="mt-3">
                    <a href="#" class="btn btn-outline-primary">
                        <i class="fas fa-edit"></i> Editar Dirección
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-user-circle"></i> Información de Cuenta</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <strong>Nombre:</strong><br>
                    <span class="text-muted">{{ cliente.user.get_full_name|default:cliente.user.username }}</span>
                </div>
                
                <div class="mb-3">
                    <strong>Email:</strong><br>
                    <span class="text-muted">{{ cliente.user.email }}</span>
                </div>
                
                <div class="mb-3">
                    <strong>DNI:</strong><br>
                    <span class="text-muted">{{ cliente.dni }}</span>
                </div>
                
                <div class="mb-3">
                    <strong>Rol:</strong><br>
                    <span class="badge bg-primary">{{ cliente.get_rol_display }}</span>
                </div>
                
                {% if cliente.obra_social %}
                <div class="mb-3">
                    <strong>Obra Social:</strong><br>
                    <span class="text-success">{{ cliente.obra_social.nombre }}</span>
                    <br><small class="text-muted">{{ cliente.obra_social.plan }}</small>
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Estadísticas</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <h4 class="text-primary">{{ cliente.pedidos.count }}</h4>
                        <small class="text-muted">Pedidos Totales</small>
                    </div>
                    <div class="col-6">
                        <h4 class="text-success">{{ pedidos_entregados_count }}</h4>
                        <small class="text-muted">Entregados</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-cog"></i> Acciones</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'seguimiento_pedidos' %}" class="btn btn-outline-primary">
                        <i class="fas fa-shopping-cart"></i> Mis Pedidos
                    </a>
                    <a href="{% url 'buscar_productos' %}" class="btn btn-outline-success">
                        <i class="fas fa-search"></i> Buscar Medicamentos
                    </a>
                    <a href="{% url 'contacto' %}" class="btn btn-outline-info">
                        <i class="fas fa-headset"></i> Soporte
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    var selectObra = document.getElementById('{{ form.obra_social.id_for_label }}');
    var campoAfiliado = document.getElementById('campo-numero-afiliado');
    function toggleAfiliado(){
        if (!selectObra) return;
        var hasObra = selectObra.value && selectObra.value !== '';
        campoAfiliado.style.display = hasObra ? 'block' : 'none';
    }
    if (selectObra) {
        toggleAfiliado();
        selectObra.addEventListener('change', toggleAfiliado);
    }
});
</script>
{% endblock %}


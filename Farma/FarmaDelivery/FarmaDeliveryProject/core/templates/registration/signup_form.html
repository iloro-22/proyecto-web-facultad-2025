{% extends 'core/base.html' %}
{% block title %}Registro {{ user_type }} - FarmaDelivery{% endblock %}

{% block content %}
<style>
    .container-registro { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); padding: 40px; width: 100%; max-width: 600px; margin: 40px auto; }
    .logo { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 30px; }
    .logo i { font-size: 2.5rem; color: var(--primary); }
    .logo h1 { font-size: 2rem; color: var(--primary); font-weight: bold; }
    .container-registro h2 { font-size: 1.8rem; color: var(--dark); margin-bottom: 30px; font-weight: 600; text-align: center; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem; transition: border-color 0.3s ease; background-color: white; }
    .form-group input[type="file"] { padding: 10px; border: 1px solid #ccc; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); }
    .form-row { display: flex; flex-wrap: wrap; gap: 15px; }
    .form-row .form-group { flex: 1; min-width: 200px; }
    .errorlist { list-style: none; color: var(--error); font-size: 0.9rem; margin-top: 5px; padding-left: 0; }
    .btn-registro { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; }
    .btn-registro:hover { background: #1e6bc7; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(42, 125, 225, 0.3); }
    .back-link { display: inline-block; margin-top: 20px; color: var(--primary); text-decoration: none; font-weight: 500; }
    .back-link:hover { color: var(--secondary); text-decoration: underline; }
    .required { color: var(--error); }
    .full-width { flex: 0 0 100% !important; }
    #moto-fields { display: none; }
</style>

<div class="container-registro">
    <div class="logo">
        <i class="fas fa-pills"></i>
        <h1>FarmaDelivery</h1>
    </div>
    <h2>Registro de {{ user_type }}</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.dni.id_for_label }}">{{ form.dni.label }} <span class="required">*</span></label>
            {{ form.dni }}
            {% if form.dni.errors %} <ul class="errorlist"> {% for error in form.dni.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
        </div>

        <div class="form-row">
            <div class="form-group full-width">
                <label for="{{ form.email.id_for_label }}">Email <span class="required">*</span></label>
                {{ form.email }}
                {% if form.email.errors %} <ul class="errorlist"> {% for error in form.email.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
        </div>

        {% if user_type != 'Farmacia' %}
        <div class="form-row">
            <div class="form-group">
                <label for="{{ form.first_name.id_for_label }}">{{ form.first_name.label }} <span class="required">*</span></label>
                {{ form.first_name }}
                {% if form.first_name.errors %} <ul class="errorlist"> {% for error in form.first_name.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
            <div class="form-group">
                <label for="{{ form.last_name.id_for_label }}">{{ form.last_name.label }} <span class="required">*</span></label>
                {{ form.last_name }}
                {% if form.last_name.errors %} <ul class="errorlist"> {% for error in form.last_name.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="form-row">
            <div class="form-group">
                <label for="{{ form.password1.id_for_label }}">Contraseña <span class="required">*</span></label>
                {{ form.password1 }}
                {% if form.password1.errors %} <ul class="errorlist"> {% for error in form.password1.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
            <div class="form-group">
                <label for="{{ form.password2.id_for_label }}">Confirmar contraseña <span class="required">*</span></label>
                {{ form.password2 }}
                {% if form.password2.errors %} <ul class="errorlist"> {% for error in form.password2.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
        </div>

        {% if user_type == 'Cliente' %}
            <div class="form-group">
                <label for="{{ form.obra_social.id_for_label }}">{{ form.obra_social.label }}</label>
                {{ form.obra_social }}
            </div>
            <div class="form-group">
                <label for="{{ form.numero_afiliado.id_for_label }}">{{ form.numero_afiliado.label }}</label>
                {{ form.numero_afiliado }}
            </div>
        {% elif user_type == 'Farmacia' %}
            <div class="form-group">
                <label for="{{ form.nombre_farmacia.id_for_label }}">{{ form.nombre_farmacia.label }} <span class="required">*</span></label>
                {{ form.nombre_farmacia }}
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ form.cuit.id_for_label }}">{{ form.cuit.label }} <span class="required">*</span></label>
                    {{ form.cuit }}
                </div>
                <div class="form-group">
                    <label for="{{ form.matricula.id_for_label }}">{{ form.matricula.label }} <span class="required">*</span></label>
                    {{ form.matricula }}
                </div>
            </div>
            <div class="form-group">
                <label for="{{ form.telefono.id_for_label }}">Teléfono <span class="required">*</span></label>
                {{ form.telefono }}
            </div>
             <div class="form-group">
                <label for="{{ form.email_contacto.id_for_label }}">{{ form.email_contacto.label }} <span class="required">*</span></label>
                {{ form.email_contacto }}
            </div>
        {% elif user_type == 'Repartidor' %}
            <div class="form-group">
                <label for="{{ form.telefono.id_for_label }}">Teléfono <span class="required">*</span></label>
                {{ form.telefono }}
                {% if form.telefono.errors %} <ul class="errorlist"> {% for error in form.telefono.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
            <div class="form-group">
                <label for="{{ form.tipo_vehiculo.id_for_label }}">{{ form.tipo_vehiculo.label }} <span class="required">*</span></label>
                {{ form.tipo_vehiculo }}
                {% if form.tipo_vehiculo.errors %} <ul class="errorlist"> {% for error in form.tipo_vehiculo.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
            </div>
            <div id="moto-fields">
                <div class="form-group">
                    <label for="{{ form.patente.id_for_label }}">{{ form.patente.label }} <span class="required">*</span></label>
                    {{ form.patente }}
                    {% if form.patente.errors %} <ul class="errorlist"> {% for error in form.patente.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
                </div>
                <div class="form-group">
                    <label for="{{ form.cedula_vehiculo.id_for_label }}">{{ form.cedula_vehiculo.label }} <span class="required">*</span></label>
                    {{ form.cedula_vehiculo }}
                    {% if form.cedula_vehiculo.errors %} <ul class="errorlist"> {% for error in form.cedula_vehiculo.errors %} <li>{{ error }}</li> {% endfor %} </ul> {% endif %}
                </div>
            </div>
        {% endif %}

        <h3 style="margin: 30px 0 20px 0; color: var(--dark);">Dirección</h3>
        <div class="form-row">
            <div class="form-group" style="flex: 3;">
                <label for="{{ form.calle.id_for_label }}">Calle <span class="required">*</span></label>
                {{ form.calle }}
            </div>
            <div class="form-group" style="flex: 1;">
                <label for="{{ form.numero.id_for_label }}">Número <span class="required">*</span></label>
                {{ form.numero }}
            </div>
        </div>
        <div class="form-group">
            <label for="{{ form.entre_calles.id_for_label }}">Entre calles (Opcional)</label>
            {{ form.entre_calles }}
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for="{{ form.ciudad.id_for_label }}">Ciudad <span class="required">*</span></label>
                {{ form.ciudad }}
            </div>
            <div class="form-group">
                <label for="{{ form.provincia.id_for_label }}">Provincia <span class="required">*</span></label>
                {{ form.provincia }}
            </div>
            <div class="form-group">
                <label for="{{ form.codigo_postal.id_for_label }}">Código Postal <span class="required">*</span></label>
                {{ form.codigo_postal }}
            </div>
        </div>

        <button type="submit" class="btn btn-registro">
            <i class="fas fa-user-plus"></i> Registrarse como {{ user_type }}
        </button>
    </form>

    <a href="{% url 'select_signup' %}" class="back-link">
        <i class="fas fa-arrow-left"></i> Volver a selección
    </a>
</div>
{% endblock %}

{# Agregamos el script de JavaScript al final #}
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Solo ejecuta este script si estamos en la página de registro de repartidor
        const userType = "{{ user_type|escapejs }}";
        if (userType === 'Repartidor') {

            const tipoVehiculoSelect = document.getElementById('{{ form.tipo_vehiculo.id_for_label }}');
            const motoFieldsDiv = document.getElementById('moto-fields');

            function toggleMotoFields() {
                if (tipoVehiculoSelect && motoFieldsDiv) {
                    if (tipoVehiculoSelect.value === 'MOTO') {
                        motoFieldsDiv.style.display = 'block';
                    } else {
                        motoFieldsDiv.style.display = 'none';
                    }
                }
            }

            if (tipoVehiculoSelect) {
                toggleMotoFields(); // Llama al cargar
                tipoVehiculoSelect.addEventListener('change', toggleMotoFields); // Llama al cambiar
            }
        }
    });
</script>
{% endblock %}